---
phase: 04-quality-+-playbooks
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - swift-agent-skill/references/performance.md
  - swift-agent-skill/references/testing-di.md
autonomous: true

must_haves:
  truths:
    - "User can apply a SwiftUI performance baseline checklist to avoid common pitfalls."
    - "User can use identity stability and expensive-work avoidance patterns safely."
    - "User can add lightweight DI/testing seams that reduce refactor risk without new tools."
  artifacts:
    - path: "swift-agent-skill/references/performance.md"
      provides: "Baseline performance checklist, identity stability guidance, and safe optimizations."
      contains: "Performance baseline"
    - path: "swift-agent-skill/references/testing-di.md"
      provides: "Lightweight DI seams and refactor-safe testing guidance."
      contains: "Refactor safety seams"
  key_links:
    - from: "swift-agent-skill/references/performance.md"
      to: "swift-agent-skill/references/lists-collections.md"
      via: "Cross-reference for stable identity"
      pattern: "lists-collections.md"
    - from: "swift-agent-skill/references/performance.md"
      to: "swift-agent-skill/references/scrolling.md"
      via: "Cross-reference for lazy containers and pagination"
      pattern: "scrolling.md"
    - from: "swift-agent-skill/references/testing-di.md"
      to: "swift-agent-skill/references/workflows-refactor.md"
      via: "Cross-reference for refactor safety"
      pattern: "workflows-refactor.md"
---

<objective>
Publish concise, constraint-aligned performance and testing/DI guidance that agents can apply safely.

Purpose: Deliver Phase 4 quality and testing seams requirements without tool mandates or architecture prescriptions.
Output: Updated performance and testing/DI references with baseline checklists and refactor-safe patterns.
</objective>

<execution_context>
@~/.config/opencode/get-shit-done/workflows/execute-plan.md
@~/.config/opencode/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/04-quality-+-playbooks/04-RESEARCH.md
@swift-agent-skill/references/performance.md
@swift-agent-skill/references/testing-di.md
@swift-agent-skill/references/lists-collections.md
@swift-agent-skill/references/scrolling.md
@swift-agent-skill/references/workflows-refactor.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Refocus performance guidance on baseline + safe patterns</name>
  <files>swift-agent-skill/references/performance.md</files>
  <action>
Rewrite the performance reference to be a concise baseline checklist plus safe SwiftUI patterns.

- Replace the existing workflow tree with a "Performance baseline" section that lists common SwiftUI pitfalls to check first (expensive work in body, unstable list identity, heavy work on main thread, detached async work).
- Add a "Safe optimizations" section that presents identity stability, lazy containers, and expensive-work avoidance as optional suggestions (use "consider" language, not mandates).
- Remove tool-specific instructions and step-by-step profiling guidance; keep a single sentence that profiling tools (Instruments) can help if issues persist without instructions.
- Remove deep concurrency examples (TaskGroup, actors, detached tasks) and replace with SwiftUI-lifecycle guidance tied to `.task` and cancellation checks.
- Replace the long output template with 2-3 short SwiftUI-specific snippets (stable identity in `ForEach`, moving formatter out of `body`, `.task(id:)` for async work).
- Add cross-links to `lists-collections.md` and `scrolling.md` where identity and lazy container guidance lives.
- Add a short "Risk cues" list for when to split a refactor due to performance risks (state ownership changes, list identity changes, async work relocation).
  </action>
  <verify>Open `swift-agent-skill/references/performance.md` and confirm the baseline checklist, safe optimizations, risk cues, and cross-links are present and no tool instructions remain.</verify>
  <done>Performance guidance is concise, SwiftUI-focused, and aligns with constraints while covering PERF-01 and PERF-02 patterns.</done>
</task>

<task type="auto">
  <name>Task 2: Add lightweight testing/DI seams for refactor safety</name>
  <files>swift-agent-skill/references/testing-di.md</files>
  <action>
Refactor the testing/DI reference to emphasize lightweight seams and refactor safety without tool mandates.

- Add a "Refactor safety seams" section: protocol abstraction, initializer injection with defaults, and closure-based seams for small dependencies.
- Add a short "Test doubles quick guide" (stub/mock/spy/fake) with one minimal example and keep it framework-agnostic.
- Trim or replace heavy test framework guidance; avoid prescribing specific tools or test runners beyond mentioning XCTest as the default if tests exist.
- Remove or mark ViewInspector as optional and non-required; do not present third-party libraries as defaults.
- Add a "When to add seams" checklist tied to refactor risk cues (state ownership changes, navigation rewrites, side-effect boundaries).
- Link to `workflows-refactor.md` for behavior-preserving refactor steps.
  </action>
  <verify>Open `swift-agent-skill/references/testing-di.md` and confirm the new seams checklist, quick guide, and refactor links are present without tool mandates.</verify>
  <done>Testing/DI guidance is lightweight, refactor-safe, and satisfies TEST-01 without adding new dependencies.</done>
</task>

</tasks>

<verification>
- `swift-agent-skill/references/performance.md` focuses on baseline pitfalls, identity stability, and safe optimizations without tool steps.
- `swift-agent-skill/references/testing-di.md` provides lightweight DI seams and testability guidance without framework mandates.
</verification>

<success_criteria>
- PERF-01 and PERF-02 are addressed by the performance baseline and identity/expensive-work avoidance patterns.
- TEST-01 is addressed with lightweight DI seams and refactor-safety guidance.
</success_criteria>

<output>
After completion, create `.planning/phases/04-quality-+-playbooks/04-01-SUMMARY.md`
</output>
