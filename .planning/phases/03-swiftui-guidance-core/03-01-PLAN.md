---
phase: 03-swiftui-guidance-core
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - swift-agent-skill/references/state.md
  - swift-agent-skill/references/view-composition.md
  - swift-agent-skill/references/navigation.md
  - swift-agent-skill/references/lists-collections.md
  - swift-agent-skill/references/modern-swiftui-apis.md
  - swift-agent-skill/SKILL.md
autonomous: true

must_haves:
  truths:
    - "User can choose the correct SwiftUI state wrapper using ownership guidance and decision trees."
    - "User can implement modern navigation with NavigationStack and navigationDestination patterns."
    - "User can build lists and collections with stable identity and lazy containers."
    - "User can structure view composition and layout using alignment, spacing, and adaptive patterns."
    - "User can replace deprecated SwiftUI APIs using a modern replacement catalog."
  artifacts:
    - path: "swift-agent-skill/references/state.md"
      provides: "State ownership decision tree plus composition and layout guidance"
      contains: "State Ownership"
    - path: "swift-agent-skill/references/view-composition.md"
      provides: "View extraction + parent/child data flow guidance (immutable inputs, bindings, callbacks)"
      contains: "View Composition"
    - path: "swift-agent-skill/references/navigation.md"
      provides: "NavigationStack and destination patterns"
      contains: "NavigationStack"
    - path: "swift-agent-skill/references/lists-collections.md"
      provides: "List/collection identity and lazy container guidance"
      contains: "Stable Identity"
    - path: "swift-agent-skill/references/modern-swiftui-apis.md"
      provides: "Modern replacement catalog for deprecated SwiftUI APIs"
      contains: "Replacement Catalog"
    - path: "swift-agent-skill/SKILL.md"
      provides: "Links to new SwiftUI core guidance references"
      contains: "Reference Files"
  key_links:
    - from: "swift-agent-skill/SKILL.md"
      to: "swift-agent-skill/references/lists-collections.md"
      via: "Reference list"
      pattern: "lists-collections\.md"
    - from: "swift-agent-skill/SKILL.md"
      to: "swift-agent-skill/references/modern-swiftui-apis.md"
      via: "Reference list"
      pattern: "modern-swiftui-apis\.md"
    - from: "swift-agent-skill/references/navigation.md"
      to: "swift-agent-skill/references/modern-swiftui-apis.md"
      via: "Modern replacements mention"
      pattern: "modern-swiftui-apis\.md"
    - from: "swift-agent-skill/SKILL.md"
      to: "swift-agent-skill/references/view-composition.md"
      via: "Reference list"
      pattern: "view-composition\.md"
---

<objective>
Draft SwiftUI core guidance for state, navigation, lists, composition, layout, and modern API replacements.

Purpose: Provide concise, modern SwiftUI guidance that is consistent with skill constraints and avoids architecture mandates.
Output: Updated core references, new lists and modernization references, and SKILL.md wiring.
</objective>

<execution_context>
@~/.config/opencode/get-shit-done/workflows/execute-plan.md
@~/.config/opencode/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/03-swiftui-guidance-core/03-RESEARCH.md
@swift-agent-skill/SKILL.md
@swift-agent-skill/references/state.md
@swift-agent-skill/references/navigation.md
@swift-agent-skill/references/sources.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Refresh state/composition/layout guidance and modernize navigation</name>
  <files>
swift-agent-skill/references/state.md
swift-agent-skill/references/view-composition.md
swift-agent-skill/references/navigation.md
  </files>
  <action>
Update SwiftUI core guidance to align with constraints and modern APIs.

- In `state.md`:
  - Add a state ownership decision tree that maps ownership and sharing to wrappers (`@State`, `@Binding`, `@Environment`, `@Observable`/`ObservableObject`).
  - Clarify when to use `@Observable` (iOS 17+), and provide a fallback to `ObservableObject` where needed without mandating architecture patterns.
  - Keep this doc focused on state ownership and wrapper selection guidance (decision tree + examples).
  - Avoid mixing view extraction/composition rules into this file; those live in `references/view-composition.md`.
  - Add layout guidance covering stacks, alignment, spacing, and adaptive layout patterns (size classes, `Layout`-safe principles) without prescribing folder structure or MVVM.
  - Remove or reframe any architecture mandate language (no coordinators, no required view model layer, no required app structure).
  - Keep rules factual and scoped to SwiftUI guidance; avoid tool-specific steps.

- In `view-composition.md`:
  - Document safe view extraction patterns that preserve identity and state.
  - Include parent/child data flow rules:
    - pass immutable values for display
    - use `@Binding` for edit flows
    - use callbacks for events (tap, submit, delete, etc.)
  - Explain where state should live (hoist vs local), with “smells” and “fixes”.
  - Include short “Bad → Better” examples (no architecture mandates).
  - Add a tiny “Invariants” section:
    - stable IDs stay stable
    - state ownership stays correct
    - navigation state remains source-of-truth
    - async work remains cancellable

- In `navigation.md`:
  - Emphasize `NavigationStack`, `NavigationLink(value:)`, and `navigationDestination(for:)` patterns.
  - Provide guidance on navigation state ownership (single source of truth) without requiring coordinator patterns.
  - Include sheets and full-screen presentation patterns with `sheet(item:)` and `fullScreenCover`, plus dismissal using `dismiss`.
  - Keep guidance modern and avoid nested `NavigationStack` anti-patterns.
  - If mentioning advanced patterns (paths, deep links), keep them optional and clearly labeled as “consider when needed”.
  - Add a brief link to `references/modern-swiftui-apis.md` for navigation-related replacements.
  </action>
  <verify>
Open `swift-agent-skill/references/state.md` and confirm it contains a state ownership decision tree, then confirm `swift-agent-skill/references/view-composition.md` contains view extraction/data flow guidance, then check `swift-agent-skill/references/navigation.md` for NavigationStack-based patterns without coordinator mandates.

  </verify>
  <done>State, composition, layout, and navigation guidance is modern, constraint-aligned, and free of architecture mandates.</done>
</task>

<task type="auto">
  <name>Task 2: Add lists/collections guidance and modern API replacement catalog, then wire into SKILL.md</name>
  <files>
swift-agent-skill/references/lists-collections.md
swift-agent-skill/references/modern-swiftui-apis.md
swift-agent-skill/SKILL.md
  </files>
  <action>
Create new reference docs for list/collection guidance and modern API replacements, then link them from SKILL.md.

- Create `references/lists-collections.md` with:
  - Stable identity rules (`Identifiable`, stable `id:`), and a clear warning against `.indices` for dynamic data.
  - Guidance on `List` vs `ScrollView + LazyVStack`, and when to use lazy containers.
  - Best practices for sections, empty states, and row content composition.
  - Common pitfalls and how to avoid them (identity churn, excessive row work, row-level side effects).

- Create `references/modern-swiftui-apis.md` with:
  - A replacement catalog table of deprecated or legacy APIs to modern equivalents (e.g., `NavigationView` -> `NavigationStack`, `navigationBarItems` -> `toolbar`, `navigationBarTitle` -> `navigationTitle`, `foregroundColor` -> `foregroundStyle`).
  - Notes on when to prefer the modern API and any availability caveats, without asserting uncertain deprecation details.

- Update `swift-agent-skill/SKILL.md` to:
  - Add the new references in the Reference Files list.
  - Update the Quick Decision Guide to include list/collection guidance and modern API replacements.
  - Keep the core guidelines concise and avoid duplicating the new reference content.
  </action>
  <verify>
Confirm the new reference files exist and SKILL.md links to them in the Reference Files list and Quick Decision Guide.
  </verify>
  <done>List/collection guidance and the modern API replacement catalog are authored and discoverable from SKILL.md.</done>
</task>

</tasks>

<verification>
- `references/state.md` includes an ownership decision tree and layout/composition guidance aligned to constraints.
- `references/navigation.md` reflects NavigationStack patterns without coordinator mandates.
- `references/lists-collections.md` and `references/modern-swiftui-apis.md` exist and are linked from SKILL.md.
</verification>

<success_criteria>
- Users can select state wrappers, navigate with modern APIs, build stable lists, and apply a modern replacement catalog.
</success_criteria>

<output>
After completion, create `.planning/phases/03-swiftui-guidance-core/03-01-SUMMARY.md`
</output>
