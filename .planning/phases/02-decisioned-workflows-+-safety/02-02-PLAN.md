---
phase: 02-decisioned-workflows-+-safety
plan: 02
type: execute
wave: 2
depends_on:
  - 02-decisioned-workflows-+-safety/02-01
files_modified:
  - swift-patterns/references/invariants.md
  - swift-patterns/references/workflows-review.md
  - swift-patterns/references/workflows-refactor.md
  - swift-patterns/SKILL.md
autonomous: true

must_haves:
  truths:
    - "User can apply a SwiftUI refactor checklist that preserves behavior."
    - "User can apply a SwiftUI review checklist with consistent findings."
    - "User can identify risk cues that require splitting refactors or adding tests first."
    - "User can follow an invariants list that protects identity and data flow during refactors."
  artifacts:
    - path: "swift-patterns/references/invariants.md"
      provides: "Identity and data flow invariants for refactors"
      contains: "Invariants"
    - path: "swift-patterns/references/workflows-refactor.md"
      provides: "Behavior-preserving refactor checklist with risk cues"
      contains: "Refactor Checklist"
    - path: "swift-patterns/references/workflows-review.md"
      provides: "Review checklist with findings taxonomy"
      contains: "Review Checklist"
    - path: "swift-patterns/SKILL.md"
      provides: "Links to workflow checklists and invariants"
      contains: "Reference Files"
  key_links:
    - from: "swift-patterns/references/workflows-refactor.md"
      to: "swift-patterns/references/invariants.md"
      via: "Invariants reference"
      pattern: "invariants\\.md"
    - from: "swift-patterns/references/workflows-review.md"
      to: "swift-patterns/references/invariants.md"
      via: "Invariants reference"
      pattern: "invariants\\.md"
    - from: "swift-patterns/SKILL.md"
      to: "swift-patterns/references/workflows-refactor.md"
      via: "Reference list"
      pattern: "workflows-refactor\\.md"
    - from: "swift-patterns/SKILL.md"
      to: "swift-patterns/references/workflows-review.md"
      via: "Reference list"
      pattern: "workflows-review\\.md"
---

<objective>
Add workflow-specific checklists with risk cues and a shared invariants list for refactors and reviews.

Purpose: Make review and refactor outputs consistent, safe, and behavior-preserving.
Output: Workflow checklist references, invariants list, and SKILL.md links.
</objective>

<execution_context>
@~/.config/opencode/get-shit-done/workflows/execute-plan.md
@~/.config/opencode/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/02-decisioned-workflows-+-safety/02-RESEARCH.md
@swift-patterns/SKILL.md
@swift-patterns/references/state.md
@swift-patterns/references/navigation.md
@swift-patterns/references/performance.md
@swift-patterns/references/code-review-refactoring.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add shared invariants list</name>
  <files>swift-patterns/references/invariants.md</files>
  <action>
Create a shared invariants reference for refactor safety.

- List invariants that must be preserved during SwiftUI refactors:
  - Stable identity for lists and ForEach (no `.indices` for dynamic data).
  - State ownership mapping (@State local, @Binding for parent-owned, @Observable for shared).
  - Single navigation source of truth (avoid competing NavigationStack roots/path state).
  - Cancellable async work tied to view lifecycle (.task or Task cancellation).
  - Data flows down, events flow up (no direct child mutation of parent state).
- Reference the Constraints section in SKILL.md as mandatory.
- Keep language factual and non-prescriptive about architecture.
  </action>
  <verify>Open `swift-patterns/references/invariants.md` and confirm the invariants list includes identity, state ownership, navigation source of truth, and cancellable async work.</verify>
  <done>An invariants reference exists and can be reused by both workflows without duplication.</done>
</task>

<task type="auto">
  <name>Task 2: Create workflow checklists and link from SKILL.md</name>
  <files>
swift-patterns/references/workflows-review.md
swift-patterns/references/workflows-refactor.md
swift-patterns/SKILL.md
  </files>
  <action>
Create review and refactor workflow checklists and wire them into SKILL.md.

- In `workflows-review.md`, add:
  - Scope definition and inputs (code context, files, requirements).
  - Findings taxonomy (correctness, data flow, navigation, identity, performance, accessibility if mentioned in constraints).
  - Review checklist items that align with SwiftUI constraints and references.
  - A section for risk cues (when to ask for tests or split the work).
  - A required link to `references/invariants.md` and a reminder to follow Constraints in SKILL.md.
- In `workflows-refactor.md`, add:
  - A behavior-preserving refactor checklist (pre-checks, changes, verification).
  - Risk cues for splitting refactors or adding tests first.
  - A required link to `references/invariants.md` and a reminder to follow Constraints in SKILL.md.
- Update `swift-patterns/SKILL.md` to:
  - Add these workflow references in the Reference Files list.
  - Point the routing section to the workflow checklist docs.
  - Avoid duplicating checklist content inside SKILL.md.
  </action>
  <verify>
Open the workflow files and confirm both checklists include invariants links and risk cues, then verify SKILL.md links to the new workflow references.
  </verify>
  <done>Workflow checklists are authored, reference invariants and constraints, and are discoverable from SKILL.md.</done>
</task>

</tasks>

<verification>
- `references/invariants.md` exists and is linked from both workflow files.
- `references/workflows-review.md` and `references/workflows-refactor.md` include risk cues and checklist steps.
- `swift-patterns/SKILL.md` references the new workflow docs.
</verification>

<success_criteria>
- Users can follow review/refactor checklists that preserve SwiftUI behavior and identity.
- Risk cues and invariants are clearly defined and shared across workflows.
</success_criteria>

<output>
After completion, create `.planning/phases/02-decisioned-workflows-+-safety/02-02-SUMMARY.md`
</output>
